<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SM API: I/Q Streaming</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="sh-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">SM API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">I/Q Streaming </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md40">Example</a></li>
<li class="level1"><a href="#autotoc_md41">Basics</a></li>
<li class="level1"><a href="#autotoc_md42">Sample Rate, Decimation, and Bandwidth</a></li>
<li class="level1"><a href="#autotoc_md43">Polling Interface (I/Q)</a></li>
<li class="level1"><a href="#autotoc_md44">External Triggering</a></li>
<li class="level1"><a href="#autotoc_md45">Additional Information</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_C__Users_Roger_Documents_Dev_Checkout_SM_API_docs_page_iq_streaming"></a></p>
<p >The I/Q streaming mode is used to stream continuous I/Q samples at a given center frequency. The sample rate, bandwidth, center frequency, and data type can be configured. If you need to capture I/Q data at many frequencies or don't need continuous streaming capabilities, consider using the <a class="el" href="iq_sweep_list.html">I/Q Sweep List / Frequency Hopping</a> measurements.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Example</h1>
<p >For a list of all examples, please see the <em>examples/</em> folder in the SDK.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment">// Configure the device for I/Q streaming and stream for a period of time </span></div>
<div class="line"><span class="comment">// This example assumes a USB 3.0 SM device.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="sm__api_8h.html">sm_api.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> sm_example_iq_stream()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> handle = -1;</div>
<div class="line">    <a class="code hl_enumeration" href="sm__api_8h.html#ae9134082ecd9b22280319f3034a66481">SmStatus</a> status = <a class="code hl_enumvalue" href="sm__api_8h.html#ae9134082ecd9b22280319f3034a66481a6b0f736112895de9e5b2f712505f38f7">smNoError</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Uncomment this to open a USB SM device</span></div>
<div class="line">    status = <a class="code hl_function" href="sm__api_8h.html#a00dd4457e8dc9d949470a00defbd5fd0">smOpenDevice</a>(&amp;handle);</div>
<div class="line">    <span class="comment">// Uncomment this to open a networked SM device with a default network config</span></div>
<div class="line">    <span class="comment">//status = smOpenNetworkedDevice(&amp;handle, SM_ADDR_ANY, SM_DEFAULT_ADDR, SM_DEFAULT_PORT);</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check open status</span></div>
<div class="line">    <span class="keywordflow">if</span>(status != <a class="code hl_enumvalue" href="sm__api_8h.html#ae9134082ecd9b22280319f3034a66481a6b0f736112895de9e5b2f712505f38f7">smNoError</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Unable to open device\n&quot;</span>);</div>
<div class="line">        exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Configure the receiver for IQ acquisition</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a9bedf092587ad08783672b8e455601a4">smSetRefLevel</a>(handle, -20.0); <span class="comment">// -20 dBm reference level</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a0893bdca6ed868affd6f1f572a39b0e1">smSetIQCenterFreq</a>(handle, 900.0e6); <span class="comment">// 900MHz center frequency</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a5251cd783c76892d0766c14b0248a51a">smSetIQBaseSampleRate</a>(handle, <a class="code hl_enumvalue" href="sm__api_8h.html#aa734ff539b95b5d892f79051212d0962a45ef646f0d1b65a82cb72f8d8f5453c3">smIQStreamSampleRateNative</a>); <span class="comment">// Use native 50MS/s base sample rate.</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a91c88cc0e0660bb7754dcf3e442d04b1">smSetIQSampleRate</a>(handle, 2); <span class="comment">// 50 / 2 = 25MS/s IQ </span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a4de2871d9c2a7048099fa2f18990ab9e">smSetIQBandwidth</a>(handle, <a class="code hl_enumvalue" href="sm__api_8h.html#a7bc7e094191bf3da1431e2ccbd305678a6c87b99087d3d026623b584827e0513a">smTrue</a>, 20.0e6); <span class="comment">// 20MHz of bandwidth</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a1aee668d542391821bd405b9b9f1c79e">smSetIQDataType</a>(handle, <a class="code hl_enumvalue" href="sm__api_8h.html#a527d920b5c35c57a997ebc4bc5e877e9a8bde3b27646aca817219287a08b0b3f4">smDataType32fc</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize the receiver with the above settings</span></div>
<div class="line">    status = <a class="code hl_function" href="sm__api_8h.html#acf23fbdb5fe507b013d908a2eadff769">smConfigure</a>(handle, smModeIQ);</div>
<div class="line">    <span class="keywordflow">if</span>(status != <a class="code hl_enumvalue" href="sm__api_8h.html#ae9134082ecd9b22280319f3034a66481a6b0f736112895de9e5b2f712505f38f7">smNoError</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Unable to configure device\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code hl_function" href="sm__api_8h.html#ae2b7e35016843ab85bfd8ec47662906f">smGetErrorString</a>(status));</div>
<div class="line">        <a class="code hl_function" href="sm__api_8h.html#ab6f7b35d6d886375993e774fdb7dc7a2">smCloseDevice</a>(handle);</div>
<div class="line">        exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Query the receiver IQ stream characteristics</span></div>
<div class="line">    <span class="comment">// Should match what we set earlier</span></div>
<div class="line">    <span class="keywordtype">double</span> actualSampleRate, actualBandwidth;</div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a7b30b38935ccbcdf8478733bdf5896c5">smGetIQParameters</a>(handle, &amp;actualSampleRate, &amp;actualBandwidth);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Allocate memory for complex sample, IQ pairs interleaved</span></div>
<div class="line">    <span class="keywordtype">int</span> bufLen = 16384;</div>
<div class="line">    std::vector&lt;float&gt; iqBuf(bufLen * 2);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Let&#39;s acquire 5 second worth of data</span></div>
<div class="line">    <span class="keywordtype">int</span> samplesNeeded = 5 * (int)actualSampleRate;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span>(samplesNeeded &gt; 0) {</div>
<div class="line">        <span class="comment">// Notice the purge parameter is set to false, so that each time</span></div>
<div class="line">        <span class="comment">//  the get IQ function is called, the next contiguous block of data</span></div>
<div class="line">        <span class="comment">//  is returned.</span></div>
<div class="line">        <a class="code hl_function" href="sm__api_8h.html#a255e753cad64e0e7e611b93fe7b7c1b7">smGetIQ</a>(handle, &amp;iqBuf[0], bufLen, 0, 0, 0, <a class="code hl_enumvalue" href="sm__api_8h.html#a7bc7e094191bf3da1431e2ccbd305678a182711e4aa910f79fe08e3617d63293f">smFalse</a>, 0, 0);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Process/store data here</span></div>
<div class="line">        <span class="comment">// Data is interleaved 32-bit complex values</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Need bufLen less samples</span></div>
<div class="line">        samplesNeeded -= bufLen;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Finished</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#ab6f7b35d6d886375993e774fdb7dc7a2">smCloseDevice</a>(handle);</div>
<div class="line">}</div>
<div class="ttc" id="asm__api_8h_html"><div class="ttname"><a href="sm__api_8h.html">sm_api.h</a></div><div class="ttdoc">API functions for the SM435/SM200 spectrum analyzers.</div></div>
<div class="ttc" id="asm__api_8h_html_a00dd4457e8dc9d949470a00defbd5fd0"><div class="ttname"><a href="sm__api_8h.html#a00dd4457e8dc9d949470a00defbd5fd0">smOpenDevice</a></div><div class="ttdeci">SM_API SmStatus smOpenDevice(int *device)</div></div>
<div class="ttc" id="asm__api_8h_html_a0893bdca6ed868affd6f1f572a39b0e1"><div class="ttname"><a href="sm__api_8h.html#a0893bdca6ed868affd6f1f572a39b0e1">smSetIQCenterFreq</a></div><div class="ttdeci">SM_API SmStatus smSetIQCenterFreq(int device, double centerFreqHz)</div></div>
<div class="ttc" id="asm__api_8h_html_a1aee668d542391821bd405b9b9f1c79e"><div class="ttname"><a href="sm__api_8h.html#a1aee668d542391821bd405b9b9f1c79e">smSetIQDataType</a></div><div class="ttdeci">SM_API SmStatus smSetIQDataType(int device, SmDataType dataType)</div></div>
<div class="ttc" id="asm__api_8h_html_a255e753cad64e0e7e611b93fe7b7c1b7"><div class="ttname"><a href="sm__api_8h.html#a255e753cad64e0e7e611b93fe7b7c1b7">smGetIQ</a></div><div class="ttdeci">SM_API SmStatus smGetIQ(int device, void *iqBuf, int iqBufSize, double *triggers, int triggerBufSize, int64_t *nsSinceEpoch, SmBool purge, int *sampleLoss, int *samplesRemaining)</div></div>
<div class="ttc" id="asm__api_8h_html_a4de2871d9c2a7048099fa2f18990ab9e"><div class="ttname"><a href="sm__api_8h.html#a4de2871d9c2a7048099fa2f18990ab9e">smSetIQBandwidth</a></div><div class="ttdeci">SM_API SmStatus smSetIQBandwidth(int device, SmBool enableSoftwareFilter, double bandwidth)</div></div>
<div class="ttc" id="asm__api_8h_html_a5251cd783c76892d0766c14b0248a51a"><div class="ttname"><a href="sm__api_8h.html#a5251cd783c76892d0766c14b0248a51a">smSetIQBaseSampleRate</a></div><div class="ttdeci">SM_API SmStatus smSetIQBaseSampleRate(int device, SmIQStreamSampleRate sampleRate)</div></div>
<div class="ttc" id="asm__api_8h_html_a527d920b5c35c57a997ebc4bc5e877e9a8bde3b27646aca817219287a08b0b3f4"><div class="ttname"><a href="sm__api_8h.html#a527d920b5c35c57a997ebc4bc5e877e9a8bde3b27646aca817219287a08b0b3f4">smDataType32fc</a></div><div class="ttdeci">@ smDataType32fc</div><div class="ttdef"><b>Definition:</b> sm_api.h:234</div></div>
<div class="ttc" id="asm__api_8h_html_a7b30b38935ccbcdf8478733bdf5896c5"><div class="ttname"><a href="sm__api_8h.html#a7b30b38935ccbcdf8478733bdf5896c5">smGetIQParameters</a></div><div class="ttdeci">SM_API SmStatus smGetIQParameters(int device, double *sampleRate, double *bandwidth)</div></div>
<div class="ttc" id="asm__api_8h_html_a7bc7e094191bf3da1431e2ccbd305678a182711e4aa910f79fe08e3617d63293f"><div class="ttname"><a href="sm__api_8h.html#a7bc7e094191bf3da1431e2ccbd305678a182711e4aa910f79fe08e3617d63293f">smFalse</a></div><div class="ttdeci">@ smFalse</div><div class="ttdef"><b>Definition:</b> sm_api.h:378</div></div>
<div class="ttc" id="asm__api_8h_html_a7bc7e094191bf3da1431e2ccbd305678a6c87b99087d3d026623b584827e0513a"><div class="ttname"><a href="sm__api_8h.html#a7bc7e094191bf3da1431e2ccbd305678a6c87b99087d3d026623b584827e0513a">smTrue</a></div><div class="ttdeci">@ smTrue</div><div class="ttdef"><b>Definition:</b> sm_api.h:380</div></div>
<div class="ttc" id="asm__api_8h_html_a91c88cc0e0660bb7754dcf3e442d04b1"><div class="ttname"><a href="sm__api_8h.html#a91c88cc0e0660bb7754dcf3e442d04b1">smSetIQSampleRate</a></div><div class="ttdeci">SM_API SmStatus smSetIQSampleRate(int device, int decimation)</div></div>
<div class="ttc" id="asm__api_8h_html_a9bedf092587ad08783672b8e455601a4"><div class="ttname"><a href="sm__api_8h.html#a9bedf092587ad08783672b8e455601a4">smSetRefLevel</a></div><div class="ttdeci">SM_API SmStatus smSetRefLevel(int device, double refLevel)</div></div>
<div class="ttc" id="asm__api_8h_html_aa734ff539b95b5d892f79051212d0962a45ef646f0d1b65a82cb72f8d8f5453c3"><div class="ttname"><a href="sm__api_8h.html#aa734ff539b95b5d892f79051212d0962a45ef646f0d1b65a82cb72f8d8f5453c3">smIQStreamSampleRateNative</a></div><div class="ttdeci">@ smIQStreamSampleRateNative</div><div class="ttdef"><b>Definition:</b> sm_api.h:279</div></div>
<div class="ttc" id="asm__api_8h_html_ab6f7b35d6d886375993e774fdb7dc7a2"><div class="ttname"><a href="sm__api_8h.html#ab6f7b35d6d886375993e774fdb7dc7a2">smCloseDevice</a></div><div class="ttdeci">SM_API SmStatus smCloseDevice(int device)</div></div>
<div class="ttc" id="asm__api_8h_html_acf23fbdb5fe507b013d908a2eadff769"><div class="ttname"><a href="sm__api_8h.html#acf23fbdb5fe507b013d908a2eadff769">smConfigure</a></div><div class="ttdeci">SM_API SmStatus smConfigure(int device, SmMode mode)</div></div>
<div class="ttc" id="asm__api_8h_html_ae2b7e35016843ab85bfd8ec47662906f"><div class="ttname"><a href="sm__api_8h.html#ae2b7e35016843ab85bfd8ec47662906f">smGetErrorString</a></div><div class="ttdeci">SM_API const char * smGetErrorString(SmStatus status)</div></div>
<div class="ttc" id="asm__api_8h_html_ae9134082ecd9b22280319f3034a66481"><div class="ttname"><a href="sm__api_8h.html#ae9134082ecd9b22280319f3034a66481">SmStatus</a></div><div class="ttdeci">SmStatus</div><div class="ttdef"><b>Definition:</b> sm_api.h:142</div></div>
<div class="ttc" id="asm__api_8h_html_ae9134082ecd9b22280319f3034a66481a6b0f736112895de9e5b2f712505f38f7"><div class="ttname"><a href="sm__api_8h.html#ae9134082ecd9b22280319f3034a66481a6b0f736112895de9e5b2f712505f38f7">smNoError</a></div><div class="ttdeci">@ smNoError</div><div class="ttdef"><b>Definition:</b> sm_api.h:203</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md41"></a>
Basics</h1>
<p >The API provides the ability to stream I/Q samples up to the device’s native sample rate or common LTE sample rates. See <a class="el" href="index.html#iqSampleRates">I/Q Sample Rates</a> for more information.</p>
<p >I/Q data can be retrieved as 32-bit complex floats or 16-bit complex shorts. See <a class="el" href="index.html#iqDataTypes">I/Q Data Types</a> for more information.</p>
<h1><a class="anchor" id="autotoc_md42"></a>
Sample Rate, Decimation, and Bandwidth</h1>
<p >The I/Q data stream can be decimated by powers of 2 between 1 and 4096, starting at either the native sample rate or an LTE sample rate. Filtering is performed at each decimation stage. The final filter cutoff frequency is user selectable.</p>
<p >(USB SM devices only) For decimations [1,2,4,8], custom cutoff frequencies are accomplished with a PC side lowpass filter. The PC software filter is optional for decimations between 1 and 8. If the software filter is disabled the FPGA half band filters are the only alias filter used for these decimation stages and there will be aliased signals in the roll off regions of the I/Q bandwidth. Disabling the software filter will reduce CPU load of the I/Q data stream at the cost of this aliasing.</p>
<p >(10GbE SM devices only) For decimations [1,2,4,8], custom cutoff frequencies are performed on the device with no CPU penalty, and as such these filters are always active.</p>
<p >For all devices, using decimations greater than 8, decimation and filtering occur entirely on the PC. The cutoff frequency of the filter must obey the Nyquist frequency for the selected sample rate. The downsample filter sizes cannot be changed and thus the roll off transition region is a fixed size for each decimation setting.</p>
<h1><a class="anchor" id="autotoc_md43"></a>
Polling Interface (I/Q)</h1>
<p >The API for the I/Q data stream is a polling style interface, where the application must request I/Q data in blocks that will keep up with the device acquisition of data. The APIs internal circular buffer can store up to 1/2 second worth of I/Q data before data loss occurs. It is the responsibility of the user’s application to poll the I/Q data fast enough that data loss does not occur.</p>
<h1><a class="anchor" id="autotoc_md44"></a>
External Triggering</h1>
<p >External trigger information can be retrieved when I/Q streaming. Trigger information is provided through the triggers buffer in the <a class="el" href="sm__api_8h.html#a255e753cad64e0e7e611b93fe7b7c1b7">smGetIQ</a> function.</p>
<p >If a trigger buffer is provided to <a class="el" href="sm__api_8h.html#a255e753cad64e0e7e611b93fe7b7c1b7">smGetIQ</a>, any external trigger events seen during the acquisition of the returned I/Q data will be placed in the trigger buffer. External trigger events are returned as indices into the I/Q data at which the trigger event occurred. For example, if 1000 I/Q samples are requested and a trigger buffer of size 3 is provided, and the function returns with the trigger buffer set to [12,300,876], this indicates that an external trigger event occurred at I/Q sample index 12, 300, and 876 in the I/Q data returned from this function call.</p>
<p >If fewer external triggers were seen during the I/Q acquisition than the size of the trigger buffer provided, the remainder of the trigger buffer is set to the sentinel value. The default sentinel value is 0.0, so for example, if a trigger buffer of size 3 is provided, and only a single trigger event was seen, the trigger buffer will return [N, 0.0, 0.0] where N is the single trigger index returned.</p>
<p >If more trigger events were seen during the I/Q acquisition than the size of the trigger buffer, those trigger events that cannot fit in the buffer are discarded.</p>
<p >Triggers are provided as doubles and non-integer values can indicate the trigger occurred in between 2 samples. This can occur when performing decimation, as the triggers are recorded at a much higher resolution than the final sample rate.</p>
<p >A note on trigger sentinel values, the default sentinel value of 0.0 does not allow the detection of triggers occurring at the first sample point. If this is an issue, set the sentinel value to -1.0 or some other negative value which cannot be normally returned. The default value of 0.0 is the result of historical choices and will remain the default value.</p>
<h1><a class="anchor" id="autotoc_md45"></a>
Additional Information</h1>
<p >See <a class="el" href="index.html#iqAcquisition">I/Q Acquisiton</a> for more information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
