<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SM API: I/Q Sweep List / Frequency Hopping</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="sh-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">SM API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">I/Q Sweep List / Frequency Hopping </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md46">Example</a></li>
<li class="level1"><a href="#autotoc_md47">Basics</a><ul><li class="level2"><a href="#autotoc_md48">Sweep List Configuration Example</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md49">Notes on Performance</a></li>
<li class="level1"><a href="#autotoc_md50">I/Q Streaming vs I/Q Sweep List</a></li>
<li class="level1"><a href="#autotoc_md51">Additional Information</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_C__Users_Roger_Documents_Dev_Checkout_SM_API_docs_page_iq_sweep_list"></a></p>
<p >I/Q sweep list measurements perform frequency hopping I/Q captures at a list of preconfigured frequencies and capture sizes. Captures can be queued to sustain &gt; 8000 frequency hops per second.</p>
<h1><a class="anchor" id="autotoc_md46"></a>
Example</h1>
<p >For a list of all examples, please see the <em>examples/</em> folder in the SDK.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment">// Configure and perform a single sweep in the I/Q sweep list mode.</span></div>
<div class="line"><span class="comment">// Configure a sweep with 3 different frequencies and different capture sizes at each frequency. </span></div>
<div class="line"><span class="comment">// Shows how to index the sweep.</span></div>
<div class="line"><span class="comment">// For a more basic example, see the &#39;simple&#39; example.</span></div>
<div class="line"><span class="comment">// For an example which queues multiple sweeps, see the &#39;queue&#39; example.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;complex&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="sm__api_8h.html">sm_api.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> sm_example_iq_sweep_list_single()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> handle = -1;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Open a USB SM device</span></div>
<div class="line">    <a class="code hl_enumeration" href="sm__api_8h.html#ae9134082ecd9b22280319f3034a66481">SmStatus</a> status = <a class="code hl_function" href="sm__api_8h.html#a00dd4457e8dc9d949470a00defbd5fd0">smOpenDevice</a>(&amp;handle);</div>
<div class="line">    <span class="comment">// Open a networked SM device</span></div>
<div class="line">    <span class="comment">//SmStatus status = smOpenNetworkedDevice(&amp;handle, SM_ADDR_ANY, SM_DEFAULT_ADDR, SM_DEFAULT_PORT);</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(status != <a class="code hl_enumvalue" href="sm__api_8h.html#ae9134082ecd9b22280319f3034a66481a6b0f736112895de9e5b2f712505f38f7">smNoError</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Unable to open device\n&quot;</span>);</div>
<div class="line">        exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The data returned should be corrected, scaled to sqrt(mW) instead of full scale.</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a97d410e27e70a7808e6eccb13f1afb2e">smSetIQSweepListCorrected</a>(handle, <a class="code hl_enumvalue" href="sm__api_8h.html#a7bc7e094191bf3da1431e2ccbd305678a6c87b99087d3d026623b584827e0513a">smTrue</a>);</div>
<div class="line">    <span class="comment">// Returne the data at 32-bit floating point complex values</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a3b28d48393322656ea8ddc19bfad3957">smSetIQSweepListDataType</a>(handle, <a class="code hl_enumvalue" href="sm__api_8h.html#a527d920b5c35c57a997ebc4bc5e877e9a8bde3b27646aca817219287a08b0b3f4">smDataType32fc</a>);</div>
<div class="line">    <span class="comment">// 3 frequency steps</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#ab7177794498a5865a6747f0d01f964e8">smSetIQSweepListSteps</a>(handle, 3);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// If the GPS antenna is connected, this will instruct the device to</span></div>
<div class="line">    <span class="comment">// discipline to the internal GPS PPS. This will improve frequency </span></div>
<div class="line">    <span class="comment">// and timestamp accuracy.</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#ae94886f97c3249726e3ba42d776c208c">smSetGPSTimebaseUpdate</a>(handle, <a class="code hl_enumvalue" href="sm__api_8h.html#a7bc7e094191bf3da1431e2ccbd305678a6c87b99087d3d026623b584827e0513a">smTrue</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Configure all three frequency steps</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 1GHz, 1000 samples to be collected</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#ad51ad67b40bdc3d58d73eb2b1d578973">smSetIQSweepListFreq</a>(handle, 0, 1.0e9);</div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#ab611815a9ce2fd5e29c9c203a12d3a07">smSetIQSweepListRef</a>(handle, 0, -20.0);</div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a1528997a6fed74a573005528e94cc71b">smSetIQSweepListSampleCount</a>(handle, 0, 1000);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 2GHz, 3000 samples to be collected</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#ad51ad67b40bdc3d58d73eb2b1d578973">smSetIQSweepListFreq</a>(handle, 0, 2.0e9);</div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#ab611815a9ce2fd5e29c9c203a12d3a07">smSetIQSweepListRef</a>(handle, 0, -20.0);</div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a1528997a6fed74a573005528e94cc71b">smSetIQSweepListSampleCount</a>(handle, 0, 2000);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 3GHz, 3000 samples to be collected</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#ad51ad67b40bdc3d58d73eb2b1d578973">smSetIQSweepListFreq</a>(handle, 0, 3.0e9);</div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#ab611815a9ce2fd5e29c9c203a12d3a07">smSetIQSweepListRef</a>(handle, 0, -20.0);</div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#a1528997a6fed74a573005528e94cc71b">smSetIQSweepListSampleCount</a>(handle, 0, 3000);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Total samples between all 3 frequency steps</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> totalSamples = 6000;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Configure the device</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#acf23fbdb5fe507b013d908a2eadff769">smConfigure</a>(handle, <a class="code hl_enumvalue" href="sm__api_8h.html#a8ffdfc5be745a55877acb97cf907064aacf6b5dd969fd0faa40b463232c0949e2">smModeIQSweepList</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Allocate memory for the capture</span></div>
<div class="line">    std::vector&lt;std::complex&lt;float&gt;&gt; iq(totalSamples);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Memory for the timestamps</span></div>
<div class="line">    int64_t timestamps[3];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Perform the sweep</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#aada41cad112bcd8d3425e147e221f852">smIQSweepListGetSweep</a>(handle, &amp;iq[0], timestamps);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Example of how to index the data</span></div>
<div class="line">    <span class="comment">// Get pointers to the data for the 3 steps</span></div>
<div class="line">    std::complex&lt;float&gt; *step1 = &amp;iq[0];</div>
<div class="line">    std::complex&lt;float&gt; *step2 = &amp;iq[1000];</div>
<div class="line">    std::complex&lt;float&gt; *step3 = &amp;iq[3000];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Do something with the data here</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The three timestamps will be the times of the samples at </span></div>
<div class="line">    <span class="comment">//   step1[0], step2[0], and step3[0]</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// GPS lock doesn&#39;t occur immediately upon opening. If</span></div>
<div class="line">    <span class="comment">//   the GPS is cold it could take several minutes to acquire lock. If warm, it </span></div>
<div class="line">    <span class="comment">//   might not lock for several seconds. Generally the hardware will need</span></div>
<div class="line">    <span class="comment">//   to see at least 1 PPS after opening before lock can be determined. </span></div>
<div class="line">    <span class="comment">//   It will take multiple PPS after opening for disciplining to be achieved.</span></div>
<div class="line">    <span class="comment">// Call the smGetGPSState function to determine if the timestamps were returned</span></div>
<div class="line">    <span class="comment">//   under GPS lock.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Done with device</span></div>
<div class="line">    <a class="code hl_function" href="sm__api_8h.html#ab6f7b35d6d886375993e774fdb7dc7a2">smCloseDevice</a>(handle);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="asm__api_8h_html"><div class="ttname"><a href="sm__api_8h.html">sm_api.h</a></div><div class="ttdoc">API functions for the SM435/SM200 spectrum analyzers.</div></div>
<div class="ttc" id="asm__api_8h_html_a00dd4457e8dc9d949470a00defbd5fd0"><div class="ttname"><a href="sm__api_8h.html#a00dd4457e8dc9d949470a00defbd5fd0">smOpenDevice</a></div><div class="ttdeci">SM_API SmStatus smOpenDevice(int *device)</div></div>
<div class="ttc" id="asm__api_8h_html_a1528997a6fed74a573005528e94cc71b"><div class="ttname"><a href="sm__api_8h.html#a1528997a6fed74a573005528e94cc71b">smSetIQSweepListSampleCount</a></div><div class="ttdeci">SM_API SmStatus smSetIQSweepListSampleCount(int device, int step, uint32_t samples)</div></div>
<div class="ttc" id="asm__api_8h_html_a3b28d48393322656ea8ddc19bfad3957"><div class="ttname"><a href="sm__api_8h.html#a3b28d48393322656ea8ddc19bfad3957">smSetIQSweepListDataType</a></div><div class="ttdeci">SM_API SmStatus smSetIQSweepListDataType(int device, SmDataType dataType)</div></div>
<div class="ttc" id="asm__api_8h_html_a527d920b5c35c57a997ebc4bc5e877e9a8bde3b27646aca817219287a08b0b3f4"><div class="ttname"><a href="sm__api_8h.html#a527d920b5c35c57a997ebc4bc5e877e9a8bde3b27646aca817219287a08b0b3f4">smDataType32fc</a></div><div class="ttdeci">@ smDataType32fc</div><div class="ttdef"><b>Definition:</b> sm_api.h:234</div></div>
<div class="ttc" id="asm__api_8h_html_a7bc7e094191bf3da1431e2ccbd305678a6c87b99087d3d026623b584827e0513a"><div class="ttname"><a href="sm__api_8h.html#a7bc7e094191bf3da1431e2ccbd305678a6c87b99087d3d026623b584827e0513a">smTrue</a></div><div class="ttdeci">@ smTrue</div><div class="ttdef"><b>Definition:</b> sm_api.h:380</div></div>
<div class="ttc" id="asm__api_8h_html_a8ffdfc5be745a55877acb97cf907064aacf6b5dd969fd0faa40b463232c0949e2"><div class="ttname"><a href="sm__api_8h.html#a8ffdfc5be745a55877acb97cf907064aacf6b5dd969fd0faa40b463232c0949e2">smModeIQSweepList</a></div><div class="ttdeci">@ smModeIQSweepList</div><div class="ttdef"><b>Definition:</b> sm_api.h:254</div></div>
<div class="ttc" id="asm__api_8h_html_a97d410e27e70a7808e6eccb13f1afb2e"><div class="ttname"><a href="sm__api_8h.html#a97d410e27e70a7808e6eccb13f1afb2e">smSetIQSweepListCorrected</a></div><div class="ttdeci">SM_API SmStatus smSetIQSweepListCorrected(int device, SmBool corrected)</div></div>
<div class="ttc" id="asm__api_8h_html_aada41cad112bcd8d3425e147e221f852"><div class="ttname"><a href="sm__api_8h.html#aada41cad112bcd8d3425e147e221f852">smIQSweepListGetSweep</a></div><div class="ttdeci">SM_API SmStatus smIQSweepListGetSweep(int device, void *dst, int64_t *timestamps)</div></div>
<div class="ttc" id="asm__api_8h_html_ab611815a9ce2fd5e29c9c203a12d3a07"><div class="ttname"><a href="sm__api_8h.html#ab611815a9ce2fd5e29c9c203a12d3a07">smSetIQSweepListRef</a></div><div class="ttdeci">SM_API SmStatus smSetIQSweepListRef(int device, int step, double level)</div></div>
<div class="ttc" id="asm__api_8h_html_ab6f7b35d6d886375993e774fdb7dc7a2"><div class="ttname"><a href="sm__api_8h.html#ab6f7b35d6d886375993e774fdb7dc7a2">smCloseDevice</a></div><div class="ttdeci">SM_API SmStatus smCloseDevice(int device)</div></div>
<div class="ttc" id="asm__api_8h_html_ab7177794498a5865a6747f0d01f964e8"><div class="ttname"><a href="sm__api_8h.html#ab7177794498a5865a6747f0d01f964e8">smSetIQSweepListSteps</a></div><div class="ttdeci">SM_API SmStatus smSetIQSweepListSteps(int device, int steps)</div></div>
<div class="ttc" id="asm__api_8h_html_acf23fbdb5fe507b013d908a2eadff769"><div class="ttname"><a href="sm__api_8h.html#acf23fbdb5fe507b013d908a2eadff769">smConfigure</a></div><div class="ttdeci">SM_API SmStatus smConfigure(int device, SmMode mode)</div></div>
<div class="ttc" id="asm__api_8h_html_ad51ad67b40bdc3d58d73eb2b1d578973"><div class="ttname"><a href="sm__api_8h.html#ad51ad67b40bdc3d58d73eb2b1d578973">smSetIQSweepListFreq</a></div><div class="ttdeci">SM_API SmStatus smSetIQSweepListFreq(int device, int step, double freq)</div></div>
<div class="ttc" id="asm__api_8h_html_ae9134082ecd9b22280319f3034a66481"><div class="ttname"><a href="sm__api_8h.html#ae9134082ecd9b22280319f3034a66481">SmStatus</a></div><div class="ttdeci">SmStatus</div><div class="ttdef"><b>Definition:</b> sm_api.h:142</div></div>
<div class="ttc" id="asm__api_8h_html_ae9134082ecd9b22280319f3034a66481a6b0f736112895de9e5b2f712505f38f7"><div class="ttname"><a href="sm__api_8h.html#ae9134082ecd9b22280319f3034a66481a6b0f736112895de9e5b2f712505f38f7">smNoError</a></div><div class="ttdeci">@ smNoError</div><div class="ttdef"><b>Definition:</b> sm_api.h:203</div></div>
<div class="ttc" id="asm__api_8h_html_ae94886f97c3249726e3ba42d776c208c"><div class="ttname"><a href="sm__api_8h.html#ae94886f97c3249726e3ba42d776c208c">smSetGPSTimebaseUpdate</a></div><div class="ttdeci">SM_API SmStatus smSetGPSTimebaseUpdate(int device, SmBool enabled)</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md47"></a>
Basics</h1>
<p >I/Q sweep lists are finite length I/Q acquisitions across a series of frequencies. Lists of up to 1200 frequencies can be provided. At each frequency, the reference level and number of samples to be collected must be configured. One measurement/list is referred to as a “sweep” and iterates through all configured frequency steps. Several sweeps can be queued to maintain maximum throughput.</p>
<p >I/Q sweep lists are advantageous when needing to acquire a discrete number of I/Q samples at several different frequencies. I/Q samples are collected at the devices native sample rate, 50MS/s for the USB SM devices and 200MS/s for the networked SM devices. The absolute fastest the SM device can switch frequencies is 120us. When I/Q capture amounts are small at each frequency, 120us frequency switch times can be achieved for a maximum of 8333.33 frequencies per second.</p>
<p >At each frequency, a timestamp is provided indicating the nanoseconds since epoch for the fist I/Q sample at that frequency. If the internal GPS is locked, this time is GPS time, If GPS is not locked, system time is provided. Regardless of GPS lock, relative timings between timestamps are highly accurate through use of internal device counters.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Sweep List Configuration Example</h2>
<p >A list of 3 frequencies is provided, 1GHz, 2GHz, and 3GHz. At each frequency 1000 I/Q samples are configured to be collected. Once configured a sweep can be performed which captures I/Q samples at the 3 frequencies, for a total of 3000 samples. If desired, N sweeps can be queued to be performed back-to-back, resulting in N * 3000 samples to be collected. By queuing the sweeps, blind time between sweeps is reduced or eliminated, improving probability of intercept and overall measurement speed.</p>
<h1><a class="anchor" id="autotoc_md49"></a>
Notes on Performance</h1>
<p >While the user can specify an arbitrary number of samples at each frequency, the SM device is internally limited to multiples of 2048 samples. For this reason, it is optimum to round up to the next multiple of 2048, which will not affect acquisition speed and reduce the number samples discarded.</p>
<p >Maximum sweep speed occurs when at most <code>N</code> samples are requested at each frequency. For the USB SM devices, N is 2048 samples, and for the networked devices, N is 6144 samples. When &lt;= N samples are requested, the device will step at the maximum rate of 8333.33 frequencies per second. This equates to ~333GHz of spectrum coverage per second for the USB SM devices and ~1.333THz of spectrum coverage per second for the networked SM devices.</p>
<h1><a class="anchor" id="autotoc_md50"></a>
I/Q Streaming vs I/Q Sweep List</h1>
<p >One use case where I/Q sweep lists are preferred to I/Q streaming for single frequency measurements is when you know in advance how many I/Q samples you want to collect at that frequency. Using I/Q sweep lists to acquire these samples has less overhead than using I/Q streaming. Starting and stopping the I/Q stream can take ~30ms, where as the overhead associated with performing a single I/Q sweep list acquisition is 1-5ms.</p>
<h1><a class="anchor" id="autotoc_md51"></a>
Additional Information</h1>
<p >See <a class="el" href="index.html#iqAcquisition">I/Q Acquisiton</a> for more information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
